<!DOCTYPE html>
<html>
<link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
<body onload="onReady()">

<h1>Gnerate Profile</h1>

<div class="row">
  <div class="col-md-6 col-md-offset-3">
   
  <%= form_for(@profile, url: profile_url) do |f| %>
    
      <%= f.label :Name %>
      <%= f.text_field :fname,class: 'form-control', placeholder: "Name Of FLAT/PG" %>
      <br>
    
      <%= f.label :Price %>
      <%= f.text_field :price,class: 'form-control'%>
      <br>
      <%= f.label :Allowed %>
      <%= f.select :allowed, ['Only Boys', 'Only Girls', 'Both'], class: 'form-control' %>
      <br><br>
      <%= f.label :Details %>
      <%= f.text_field :details,class: 'form-control'%>

      <%= f.label :Phone %>
      <%= f.text_field :phone,class: 'form-control'%>
       <br>
      <%= f.label :Type %>
      <%= f.select :room_type, ['FLAT', 'PG'], class: 'form-control' %>
       <br><br>
       <%= f.label :Address %>
       <%= f.text_field :address,class: 'form-control' %>

       <!-- Lat lng testing -->
        <h>If you want to share your live location click live else enter your nerest popular building</h><br>
        <button onclick="getLocation();">Try it</button> 
 
        <!-- <div id="locationField"> -->
      <input id="autocomplete" placeholder="Enter your address"
              type="text"></input>
              <br>
        <input type="hidden" id="profile_lat" name="profile_lat">

        <input type="hidden" id="profile_lng" name="profile_lng">
 
        


        <br/> 
        <%= f.label :Profile_pic %>
      
        <span class="picture">
       <input type="hidden" id="profile_picture" name="profile_picture">
       </span> 
       <br>
       <input type="file" onchange="getfile()" id="photo">
       <progress value="0" id="uploader" max="100">0%</progress>
       <br/>
       <%= f.submit "Create Profile", class: "btn btn-primary",id: "submit_profile" %>
 
      <% end %>
      
      <button id="submitBtngg" onclick="myfunction()" style="display: none;">submit</button>
      

    </div>
  </div>
 <!-- script to find lat lng -->
<script>
var x = document.getElementById("demo");
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(initMap);
    } else { 
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}
function initMap(position){
  console.log("hello");
        var latt=position.coords.latitude;
        var lngg=position.coords.longitude;
        console.log(latt);
        console.log(lngg);
        var uluru = {lat: latt, lng: lngg};
       }
        

</script>

<script>
   var placeSearch, autocomplete;
      function initAutocomplete() {
        autocomplete = new google.maps.places.Autocomplete(
            (document.getElementById('autocomplete')),
            {types: ['geocode']});
         autocomplete.addListener('place_changed', fillInAddress);
      }
      function fillInAddress() {
        var place = autocomplete.getPlace();
         var lat=place.geometry.location.lat();
         var lng=place.geometry.location.lng();
         
         console.log(lat);
         console.log(lng);
         initMap2(lat,lng);
        for (var component in componentForm) {
          document.getElementById(component).value = '';
          document.getElementById(component).disabled = false;
        }
        for (var i = 0; i < place.address_components.length; i++) {
          var addressType = place.address_components[i].types[0];
          if (componentForm[addressType]) {
            var val = place.address_components[i][componentForm[addressType]];
            document.getElementById(addressType).value = val;
          }
        } 
      }
       function initMap2(latt,lngg) {
        console.log(latt);
        console.log(lngg);
        document.getElementById('profile_lat').value=latt;
        document.getElementById('profile_lng').value=lngg;
      } 
</script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDaAUsx5VVCg_KBjhv38jeMNlz9qb8kuo4&libraries=places&callback=initAutocomplete"
        async defer>
        </script>
 -->

  
      <script src="https://www.gstatic.com/firebasejs/4.10.0/firebase.js"></script>
      <script type="text/javascript">
     
      function onReady(){
          var config = {
          apiKey: "AIzaSyARSLZERWUbOj9al-p6Z1GtZ2S4laaKujk",
          authDomain: "my-first-project-92a09.firebaseapp.com",
          databaseURL: "https://my-first-project-92a09.firebaseio.com",
          projectId: "my-first-project-92a09",
          storageBucket: "my-first-project-92a09.appspot.com",
          messagingSenderId: "954106895298"
        };
        firebase.initializeApp(config);
/*        navigator.geolocation.getCurrentPosition(showPosition);
*/      };
/*      function showPosition(position) {
          console.log(position.coords.latitude, position.coords.longitude);
      }*/
    </script>
    <script type="text/javascript">
       var selectedFile;
      function getfile()
      {
          var pic = document.getElementById("photo");
          selectedFile = pic.files[0];
          console.log(selectedFile);
          document.getElementById('submit_profile').setAttribute('disabled','true');
          document.getElementById('submitBtngg').click();
      }
      function myfunction()
      {  

          var name = "<%= current_user.email%>";

          var storageRef = firebase.storage().ref('/images/'+ name);
          var uploadTask = storageRef.put(selectedFile);
          uploadTask.on('state_changed', function(snapshot){
            var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
              var uploader = document.getElementById('uploader');
              uploader.value=progress;

              switch (snapshot.state) {
                case firebase.storage.TaskState.PAUSED: 
                  console.log('Upload is paused');
                  break;
                case firebase.storage.TaskState.RUNNING: 
                  console.log('Upload is running');
                  break;
              }
          }, function(error) {console.log(error);

          }, function() {
            var downloadURL = uploadTask.snapshot.downloadURL;
            console.log(downloadURL);
            document.getElementById('profile_picture').value=downloadURL;
            document.getElementById('submit_profile').removeAttribute('disabled');
          });

      };

      </script>


</body>
</html>